import{u as e,j as t,L as n,b as s,R as a,d as i}from"./vendor-react-BNOq7jpD.js";import{e as l,g as r,h as d,i as o,j as c,k as h,l as x,m as u,o as p,r as m,p as j,q as y,a as g,s as b,t as f,v}from"./page-Dashboard.tsx-B5pXQyi2.js";const S=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const{data:s,isLoading:a}=e({queryKey:["finance","kpis"],queryFn:()=>r().then(e=>e.data)});if(a)return t.jsx("div",{children:"Loading..."});const i=l(),d=(s?.cash_on_hand||0)+(s?.accounts_receivable||0)-(s?.accounts_payable||0);return t.jsxs("div",{style:{padding:"24px"},children:[t.jsxs("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("h1",{children:"Smart Books - Finance Dashboard"}),t.jsxs("div",{style:{display:"flex",gap:"12px"},children:[t.jsx(n,{to:"/finance/smart-books/invoices",className:"btn-primary",children:"+ New Invoice"}),t.jsx(n,{to:"/finance/smart-books/bills",className:"btn-primary",children:"+ New Bill"}),t.jsx(n,{to:"/finance/smart-books/payments",className:"btn-primary",children:"+ Record Payment"})]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"20px",marginBottom:"32px"},children:[t.jsxs("div",{className:"card",style:{padding:"20px",background:"#f0f9ff",borderLeft:"4px solid #93c5fd"},children:[t.jsx("div",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px"},children:"Total Cash"}),t.jsx("div",{style:{fontSize:"28px",fontWeight:"bold",color:"#1e293b"},children:i(s?.cash_on_hand||0)}),t.jsx("div",{style:{fontSize:"12px",color:"#64748b",marginTop:"8px"},children:"All accounts"})]}),t.jsxs("div",{className:"card",style:{padding:"20px",background:"#f0fdf4",borderLeft:"4px solid #22c55e"},children:[t.jsx("div",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px"},children:"Receivables"}),t.jsx("div",{style:{fontSize:"28px",fontWeight:"bold",color:"#1e293b"},children:i(s?.accounts_receivable||0)}),t.jsx("div",{style:{fontSize:"12px",color:"#64748b",marginTop:"8px"},children:"Outstanding AR"})]}),t.jsxs("div",{className:"card",style:{padding:"20px",background:"#fef2f2",borderLeft:"4px solid #ef4444"},children:[t.jsx("div",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px"},children:"Payables"}),t.jsx("div",{style:{fontSize:"28px",fontWeight:"bold",color:"#1e293b"},children:i(s?.accounts_payable||0)}),t.jsx("div",{style:{fontSize:"12px",color:"#64748b",marginTop:"8px"},children:"Outstanding AP"})]}),t.jsxs("div",{className:"card",style:{padding:"20px",background:"#faf5ff",borderLeft:"4px solid #a855f7"},children:[t.jsx("div",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px"},children:"Net Cashflow"}),t.jsx("div",{style:{fontSize:"28px",fontWeight:"bold",color:d>=0?"#22c55e":"#ef4444"},children:i(d)}),t.jsx("div",{style:{fontSize:"12px",color:"#64748b",marginTop:"8px"},children:"Cash + AR - AP"})]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px",marginBottom:"32px"},children:[t.jsxs(n,{to:"/finance/smart-books/banking",className:"card",style:{padding:"20px",textDecoration:"none",color:"inherit",display:"block"},children:[t.jsx("div",{style:{fontSize:"24px",marginBottom:"8px"},children:"🏦"}),t.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:"Banking"}),t.jsx("div",{style:{fontSize:"14px",color:"#64748b"},children:"Manage accounts, reconcile"})]}),t.jsxs(n,{to:"/finance/smart-books/invoices",className:"card",style:{padding:"20px",textDecoration:"none",color:"inherit",display:"block"},children:[t.jsx("div",{style:{fontSize:"24px",marginBottom:"8px"},children:"📄"}),t.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:"Invoices"}),t.jsx("div",{style:{fontSize:"14px",color:"#64748b"},children:"Create & send invoices"})]}),t.jsxs(n,{to:"/finance/smart-books/bills",className:"card",style:{padding:"20px",textDecoration:"none",color:"inherit",display:"block"},children:[t.jsx("div",{style:{fontSize:"24px",marginBottom:"8px"},children:"📋"}),t.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:"Bills"}),t.jsx("div",{style:{fontSize:"14px",color:"#64748b"},children:"Manage vendor bills"})]}),t.jsxs(n,{to:"/finance/smart-books/payments",className:"card",style:{padding:"20px",textDecoration:"none",color:"inherit",display:"block"},children:[t.jsx("div",{style:{fontSize:"24px",marginBottom:"8px"},children:"💳"}),t.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:"Payments"}),t.jsx("div",{style:{fontSize:"14px",color:"#64748b"},children:"Record payments"})]}),t.jsxs(n,{to:"/finance/smart-books/expenses",className:"card",style:{padding:"20px",textDecoration:"none",color:"inherit",display:"block"},children:[t.jsx("div",{style:{fontSize:"24px",marginBottom:"8px"},children:"💰"}),t.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:"Expenses"}),t.jsx("div",{style:{fontSize:"14px",color:"#64748b"},children:"Track expenses"})]}),t.jsxs(n,{to:"/finance/smart-books/reports",className:"card",style:{padding:"20px",textDecoration:"none",color:"inherit",display:"block"},children:[t.jsx("div",{style:{fontSize:"24px",marginBottom:"8px"},children:"📊"}),t.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:"Reports"}),t.jsx("div",{style:{fontSize:"14px",color:"#64748b"},children:"P&L, Balance Sheet"})]}),t.jsxs(n,{to:"/finance/smart-books/settings",className:"card",style:{padding:"20px",textDecoration:"none",color:"inherit",display:"block"},children:[t.jsx("div",{style:{fontSize:"24px",marginBottom:"8px"},children:"⚙️"}),t.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:"Settings"}),t.jsx("div",{style:{fontSize:"14px",color:"#64748b"},children:"Configure Smart Books"})]})]}),t.jsxs("div",{className:"card",style:{padding:"20px",background:"#fffbeb",borderLeft:"2px solid #fcd34d"},children:[t.jsx("h3",{style:{margin:"0 0 12px 0",fontSize:"16px",fontWeight:"bold"},children:"🎉 Welcome to Smart Books!"}),t.jsx("p",{style:{margin:"0 0 8px 0",fontSize:"14px",color:"#64748b"},children:"Your integrated finance & accounting solution. Smart Books is tightly integrated with Procurement, Vendors, Inventory, and Contracts for seamless financial management."}),t.jsxs("ul",{style:{margin:"8px 0",paddingLeft:"20px",fontSize:"14px",color:"#64748b"},children:[t.jsx("li",{children:"Create invoices for customers and track receivables"}),t.jsx("li",{children:"Convert Purchase Orders directly into bills with one click"}),t.jsx("li",{children:"Record payments via M-PESA, Bank, Cash or Card"}),t.jsx("li",{children:"Run comprehensive financial reports (P&L, Balance Sheet, Aging)"}),t.jsx("li",{children:"Bank reconciliation with statement upload"})]})]})]})}},Symbol.toStringTag,{value:"Module"}));const C=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const n=s(),[l,r]=a.useState(!1),[c,h]=a.useState(!1),[x,u]=a.useState(null),[p,m]=a.useState({statement_date:(new Date).toISOString().slice(0,10),statement_balance:0,unmatched_transactions:[]}),[j,y]=a.useState({name:"",kind:"bank",currency:"KES",opening_balance:0}),{data:g,isLoading:b}=e({queryKey:["finance","accounts"],queryFn:()=>d().then(e=>e.data)}),{data:f}=e({queryKey:["finance","payments"],queryFn:()=>o().then(e=>e.data)}),v=i({mutationFn:e=>fetch("/api/finance/accounts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()),onSuccess:()=>{n.invalidateQueries({queryKey:["finance","accounts"]}),r(!1),y({name:"",kind:"bank",currency:"KES",opening_balance:0})}}),S=(e,t="KES")=>new Intl.NumberFormat("en-KE",{style:"currency",currency:t}).format(e),C=e=>f?.filter(t=>t.account_id===e)||[],_=e=>{const t=C(e.id);return e.opening_balance+t.reduce((e,t)=>"receipt"===t.type?e+t.amount:"disbursement"===t.type?e-t.amount:e,0)},N=g?.find(e=>e.id===x);return t.jsxs("div",{style:{padding:24},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[t.jsxs("div",{children:[t.jsx("h1",{children:"Banking & Cashflow"}),t.jsx("p",{style:{color:"#475569",marginTop:4},children:"Manage bank, M-PESA, and cash accounts. Monitor balances and start reconciliations."})]}),t.jsx("button",{className:"btn-primary",onClick:()=>r(!0),children:"+ Add Account"})]}),b?t.jsx("div",{children:"Loading accounts..."}):t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",gap:20},children:[g?.map(e=>{const n=(s=e.id,f?.filter(e=>e.account_id===s).slice(0,5)||[]);var s;const a=_(e);return t.jsxs("div",{style:{border:"1px solid #e2e8f0",borderRadius:8,padding:20,backgroundColor:"#fff"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:12},children:[t.jsxs("div",{children:[t.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:600},children:e.name}),t.jsxs("p",{style:{margin:"4px 0 0 0",fontSize:12,color:"#64748b",textTransform:"uppercase"},children:[e.kind," • ",e.currency]})]}),t.jsx("button",{className:"btn-secondary",style:{fontSize:12,padding:"4px 8px"},onClick:t=>{t.stopPropagation(),(e=>{u(e);const t=g?.find(t=>t.id===e);if(t){const n=C(e);m({statement_date:(new Date).toISOString().slice(0,10),statement_balance:_(t),unmatched_transactions:n}),h(!0)}})(e.id)},children:"Reconcile"})]}),t.jsx("div",{style:{fontSize:24,fontWeight:700,marginBottom:8},children:S(a,e.currency)}),t.jsxs("div",{style:{fontSize:12,color:"#64748b"},children:["Opening: ",S(e.opening_balance,e.currency)]}),t.jsxs("div",{style:{marginTop:16,paddingTop:16,borderTop:"1px solid #e2e8f0"},children:[t.jsx("div",{style:{fontSize:12,color:"#64748b",marginBottom:8},children:"Recent Transactions"}),0===n.length?t.jsx("div",{style:{fontSize:12,color:"#94a3b8"},children:"No transactions yet"}):n.map(n=>t.jsxs("div",{style:{fontSize:12,display:"flex",justifyContent:"space-between",marginBottom:4},children:[t.jsx("span",{style:{color:"#475569"},children:n.counterparty_name||"Internal"}),t.jsxs("span",{style:{fontWeight:600,color:"receipt"===n.type?"#22c55e":"#ef4444"},children:["receipt"===n.type?"+":"-",S(n.amount,e.currency)]})]},n.id))]})]},e.id)}),0===g?.length&&t.jsx("div",{style:{gridColumn:"1 / -1",textAlign:"center",padding:40,color:"#64748b"},children:"No accounts yet. Add a bank, M-PESA, or cash account to get started."})]}),l&&t.jsx("div",{className:"modal",children:t.jsxs("div",{className:"modal-content",children:[t.jsx("h2",{style:{marginBottom:16},children:"Add Finance Account"}),t.jsxs("form",{onSubmit:e=>{e.preventDefault(),v.mutate(j)},className:"form-grid",children:[t.jsxs("label",{children:[t.jsx("span",{children:"Name"}),t.jsx("input",{value:j.name,onChange:e=>y(t=>({...t,name:e.target.value})),required:!0})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Type"}),t.jsxs("select",{value:j.kind,onChange:e=>y(t=>({...t,kind:e.target.value})),children:[t.jsx("option",{value:"bank",children:"Bank"}),t.jsx("option",{value:"mobile_money",children:"Mobile Money (M-PESA)"}),t.jsx("option",{value:"cash",children:"Cash"}),t.jsx("option",{value:"card",children:"Card"})]})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Currency"}),t.jsx("input",{value:j.currency,onChange:e=>y(t=>({...t,currency:e.target.value.toUpperCase()})),maxLength:3})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Opening Balance"}),t.jsx("input",{type:"number",step:"0.01",value:j.opening_balance,onChange:e=>y(t=>({...t,opening_balance:Number(e.target.value)}))})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:12,gridColumn:"1 / -1"},children:[t.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>r(!1),children:"Cancel"}),t.jsx("button",{type:"submit",className:"btn-primary",disabled:v.isPending,children:"Save Account"})]})]})]})}),c&&N&&t.jsx("div",{className:"modal",children:t.jsxs("div",{className:"modal-content",style:{maxWidth:800},children:[t.jsxs("h2",{style:{marginBottom:8},children:["Reconcile ",N.name]}),t.jsx("p",{style:{color:"#64748b",fontSize:14,marginBottom:24},children:"Match your bank statement with recorded transactions"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20,marginBottom:24},children:[t.jsxs("div",{style:{padding:16,backgroundColor:"#f8fafc",borderRadius:8},children:[t.jsx("div",{style:{fontSize:12,color:"#64748b",marginBottom:4},children:"Book Balance"}),t.jsx("div",{style:{fontSize:24,fontWeight:700},children:S(_(N),N.currency)})]}),t.jsxs("div",{style:{padding:16,backgroundColor:"#f8fafc",borderRadius:8},children:[t.jsx("div",{style:{fontSize:12,color:"#64748b",marginBottom:4},children:"Statement Balance"}),t.jsx("input",{type:"number",step:"0.01",value:p.statement_balance,onChange:e=>m(t=>({...t,statement_balance:Number(e.target.value)})),style:{fontSize:24,fontWeight:700,border:"none",backgroundColor:"transparent",width:"100%"}})]})]}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[t.jsx("h3",{style:{margin:0,fontSize:16},children:"Transactions to Match"}),t.jsxs("div",{style:{fontSize:14,color:"#64748b"},children:[p.unmatched_transactions.length," transaction(s)"]})]}),t.jsxs("div",{style:{maxHeight:300,overflowY:"auto",border:"1px solid #e2e8f0",borderRadius:8},children:[p.unmatched_transactions.map(e=>t.jsxs("div",{style:{padding:12,borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{fontWeight:500,marginBottom:2},children:e.counterparty_name||"Internal Transaction"}),t.jsxs("div",{style:{fontSize:12,color:"#64748b"},children:[new Date(e.payment_date).toLocaleDateString()," • ",e.reference||"No reference"]})]}),t.jsxs("div",{style:{fontWeight:600,color:"receipt"===e.type?"#22c55e":"#ef4444",marginRight:16},children:["receipt"===e.type?"+":"-",S(e.amount,N.currency)]}),t.jsx("input",{type:"checkbox",style:{width:18,height:18,cursor:"pointer"},title:"Mark as reconciled"})]},e.id)),0===p.unmatched_transactions.length&&t.jsx("div",{style:{padding:40,textAlign:"center",color:"#94a3b8"},children:"No transactions to reconcile"})]})]}),t.jsxs("div",{style:{padding:16,backgroundColor:Math.abs(_(N)-p.statement_balance)<.01?"#f0fdf4":"#fef2f2",borderRadius:8,marginBottom:16},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("span",{style:{fontWeight:600},children:"Difference:"}),t.jsx("span",{style:{fontSize:18,fontWeight:700,color:Math.abs(_(N)-p.statement_balance)<.01?"#22c55e":"#ef4444"},children:S(Math.abs(_(N)-p.statement_balance),N.currency)})]}),Math.abs(_(N)-p.statement_balance)<.01&&t.jsx("div",{style:{marginTop:8,fontSize:14,color:"#16a34a"},children:"✓ Account is reconciled!"})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:12},children:[t.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>h(!1),children:"Close"}),t.jsx("button",{type:"button",className:"btn-primary",disabled:Math.abs(_(N)-p.statement_balance)>=.01,children:"Complete Reconciliation"})]})]})})]})}},Symbol.toStringTag,{value:"Module"}));const _=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const n=s(),[l,r]=a.useState(!1),[d,o]=a.useState({customer_id:"",invoice_date:(new Date).toISOString().slice(0,10),due_date:new Date(Date.now()+12096e5).toISOString().slice(0,10),items:[{description:"",quantity:1,unit_price:0}],memo:""}),{data:p,isLoading:m}=e({queryKey:["finance","invoices"],queryFn:()=>h().then(e=>e.data)}),{data:j}=e({queryKey:["finance","customers"],queryFn:()=>x("customer").then(e=>e.data)}),{data:y}=e({queryKey:["finance","taxRates"],queryFn:()=>u().then(e=>e.data)}),g=i({mutationFn:()=>{const e=`INV-${Date.now()}`,t={...d,number:e,items:d.items.map(e=>({...e,tax_amount:e.tax_rate_id?e.quantity*e.unit_price*(y?.find(t=>t.id===e.tax_rate_id)?.rate_percent||0)/100:0}))};return c(t).then(e=>e.data)},onSuccess:()=>{n.invalidateQueries({queryKey:["finance","invoices"]}),n.invalidateQueries({queryKey:["finance","kpis"]}),r(!1),o({customer_id:"",invoice_date:(new Date).toISOString().slice(0,10),due_date:new Date(Date.now()+12096e5).toISOString().slice(0,10),items:[{description:"",quantity:1,unit_price:0}],memo:""})}}),b=(e,t,n)=>{o(s=>({...s,items:s.items.map((s,a)=>a===e?{...s,[t]:n}:s)}))},f=d.items.reduce((e,t)=>e+t.quantity*t.unit_price,0),v=d.items.reduce((e,t)=>{if(!t.tax_rate_id)return e;const n=y?.find(e=>e.id===t.tax_rate_id);return e+(n?t.quantity*t.unit_price*(n.rate_percent/100):0)},0),S=f+v;return t.jsxs("div",{style:{padding:24},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[t.jsxs("div",{children:[t.jsx("h1",{children:"Invoices (Accounts Receivable)"}),t.jsx("p",{style:{color:"#475569",marginTop:4},children:"Create and track invoices, send PDF/emails, and accept M-PESA payments."})]}),t.jsx("button",{className:"btn-primary",onClick:()=>r(!0),children:"+ New Invoice"})]}),m?t.jsx("div",{children:"Loading invoices..."}):t.jsxs("table",{className:"table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Number"}),t.jsx("th",{children:"Customer"}),t.jsx("th",{children:"Date"}),t.jsx("th",{children:"Due"}),t.jsx("th",{children:"Status"}),t.jsx("th",{children:"Total"}),t.jsx("th",{children:"Balance"}),t.jsx("th",{children:"Actions"})]})}),t.jsx("tbody",{children:p?.length?p.map(e=>t.jsxs("tr",{children:[t.jsx("td",{children:e.number}),t.jsx("td",{children:e.customer_name}),t.jsx("td",{children:new Date(e.invoice_date).toLocaleDateString()}),t.jsx("td",{children:new Date(e.due_date).toLocaleDateString()}),t.jsx("td",{children:t.jsx("span",{className:`status-pill status-${e.status.replace(/_/g,"-")}`,children:e.status.toUpperCase()})}),t.jsx("td",{children:e.total.toLocaleString()}),t.jsx("td",{children:e.balance.toLocaleString()}),t.jsxs("td",{children:[t.jsx("button",{className:"btn-link",children:"Send"}),t.jsx("button",{className:"btn-link",children:"Record Payment"})]})]},e.id)):t.jsx("tr",{children:t.jsx("td",{colSpan:8,style:{textAlign:"center",padding:24,color:"#64748b"},children:"No invoices yet. Create your first invoice to start tracking receivables."})})})]}),l&&t.jsx("div",{className:"modal",children:t.jsxs("div",{className:"modal-content",style:{maxWidth:900,width:"90vw"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("h2",{children:"Create Invoice"}),t.jsx("button",{className:"btn-secondary",onClick:()=>r(!1),children:"Close"})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault(),g.mutate()},className:"form-grid",children:[t.jsxs("label",{children:[t.jsx("span",{children:"Customer"}),t.jsxs("select",{value:d.customer_id,onChange:e=>o(t=>({...t,customer_id:e.target.value})),required:!0,children:[t.jsx("option",{value:"",disabled:!0,children:"Select customer"}),j?.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Invoice Date"}),t.jsx("input",{type:"date",value:d.invoice_date,onChange:e=>o(t=>({...t,invoice_date:e.target.value})),required:!0})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Due Date"}),t.jsx("input",{type:"date",value:d.due_date,onChange:e=>o(t=>({...t,due_date:e.target.value})),required:!0})]}),t.jsxs("div",{style:{gridColumn:"1 / -1",marginTop:12},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[t.jsx("h3",{style:{margin:0},children:"Invoice Items"}),t.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{o(e=>({...e,items:[...e.items,{description:"",quantity:1,unit_price:0}]}))},children:"+ Add Line"})]}),t.jsx("div",{className:"card",style:{padding:12},children:d.items.map((e,n)=>t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr repeat(4, 1fr)",gap:12,marginBottom:12},children:[t.jsx("input",{placeholder:"Description",value:e.description,onChange:e=>b(n,"description",e.target.value),required:!0}),t.jsx("input",{type:"number",min:1,value:e.quantity,onChange:e=>b(n,"quantity",Number(e.target.value))}),t.jsx("input",{type:"number",min:0,step:"0.01",value:e.unit_price,onChange:e=>b(n,"unit_price",Number(e.target.value))}),t.jsxs("select",{value:e.tax_rate_id||"",onChange:e=>b(n,"tax_rate_id",e.target.value||void 0),children:[t.jsx("option",{value:"",children:"No Tax"}),y?.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",e.rate_percent,"%)"]},e.id))]}),t.jsx("div",{style:{alignSelf:"center",fontWeight:600,textAlign:"right"},children:(e.quantity*e.unit_price).toLocaleString()})]},n))})]}),t.jsxs("label",{style:{gridColumn:"1 / -1"},children:[t.jsx("span",{children:"Notes (optional)"}),t.jsx("textarea",{value:d.memo,onChange:e=>o(t=>({...t,memo:e.target.value})),rows:3})]}),t.jsxs("div",{style:{gridColumn:"1 / -1",background:"#f8fafc",borderRadius:8,padding:16},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[t.jsx("span",{children:"Subtotal"}),t.jsx("span",{children:f.toLocaleString()})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[t.jsx("span",{children:"Tax"}),t.jsx("span",{children:v.toLocaleString()})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:700},children:[t.jsx("span",{children:"Total"}),t.jsx("span",{children:S.toLocaleString()})]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:12,gridColumn:"1 / -1"},children:[t.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>r(!1),children:"Cancel"}),t.jsx("button",{type:"submit",className:"btn-primary",disabled:g.isPending||!d.customer_id,children:"Save Invoice"})]})]})]})})]})}},Symbol.toStringTag,{value:"Module"}));const N=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const n=s(),[l,r]=a.useState(!1),[d,o]=a.useState(null),[c,h]=a.useState(!1),[y,g]=a.useState({amount:0,payment_date:(new Date).toISOString().slice(0,10),account_id:"",reference:"",memo:""}),[b,f]=a.useState({vendor_id:"",bill_date:(new Date).toISOString().slice(0,10),due_date:new Date(Date.now()+2592e6).toISOString().slice(0,10),items:[{description:"",quantity:1,unit_price:0}],memo:""}),{data:v,isLoading:S}=e({queryKey:["finance","bills"],queryFn:()=>j().then(e=>e.data)}),{data:C}=e({queryKey:["finance","vendors"],queryFn:()=>x("vendor").then(e=>e.data)}),{data:_}=e({queryKey:["finance","taxRates"],queryFn:()=>u().then(e=>e.data)}),N=i({mutationFn:()=>{const e=`BILL-${Date.now()}`,t={...b,number:e,items:b.items.map(e=>({...e,tax_amount:e.tax_rate_id?e.quantity*e.unit_price*(_?.find(t=>t.id===e.tax_rate_id)?.rate_percent||0)/100:0}))};return p(t).then(e=>e.data)},onSuccess:()=>{n.invalidateQueries({queryKey:["finance","bills"]}),n.invalidateQueries({queryKey:["finance","kpis"]}),r(!1),f({vendor_id:"",bill_date:(new Date).toISOString().slice(0,10),due_date:new Date(Date.now()+2592e6).toISOString().slice(0,10),items:[{description:"",quantity:1,unit_price:0}],memo:""})}}),k=i({mutationFn:()=>{if(!d)throw new Error("No bill selected");return m(d.id,y).then(e=>e.data)},onSuccess:()=>{n.invalidateQueries({queryKey:["finance","bills"]}),n.invalidateQueries({queryKey:["finance","kpis"]}),n.invalidateQueries({queryKey:["finance","payments"]}),h(!1),o(null),g({amount:0,payment_date:(new Date).toISOString().slice(0,10),account_id:"",reference:"",memo:""})}}),w=(e,t,n)=>{f(s=>({...s,items:s.items.map((s,a)=>a===e?{...s,[t]:n}:s)}))},B=b.items.reduce((e,t)=>e+t.quantity*t.unit_price,0),q=b.items.reduce((e,t)=>{if(!t.tax_rate_id)return e;const n=_?.find(e=>e.id===t.tax_rate_id);return e+(n?t.quantity*t.unit_price*(n.rate_percent/100):0)},0),D=B+q,T=e=>new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES"}).format(e);return t.jsxs("div",{style:{padding:24},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[t.jsxs("div",{children:[t.jsx("h1",{children:"Vendor Bills (Accounts Payable)"}),t.jsx("p",{style:{color:"#475569",marginTop:4},children:"Track vendor bills and schedule payments."})]}),t.jsx("div",{style:{display:"flex",gap:12},children:t.jsx("button",{className:"btn-primary",onClick:()=>r(!0),children:"+ New Bill"})})]}),S?t.jsx("div",{children:"Loading bills..."}):t.jsxs("table",{className:"table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Number"}),t.jsx("th",{children:"Vendor"}),t.jsx("th",{children:"Bill Date"}),t.jsx("th",{children:"Due Date"}),t.jsx("th",{children:"Status"}),t.jsx("th",{children:"Total"}),t.jsx("th",{children:"Balance"}),t.jsx("th",{children:"Actions"})]})}),t.jsx("tbody",{children:v?.length?v.map(e=>t.jsxs("tr",{children:[t.jsx("td",{children:e.number}),t.jsx("td",{children:e.vendor_name}),t.jsx("td",{children:new Date(e.bill_date).toLocaleDateString()}),t.jsx("td",{children:new Date(e.due_date).toLocaleDateString()}),t.jsx("td",{children:t.jsx("span",{className:`status-pill status-${e.status.replace(/_/g,"-")}`,children:e.status.toUpperCase()})}),t.jsx("td",{children:T(e.total)}),t.jsx("td",{children:T(e.balance)}),t.jsx("td",{children:e.balance>0&&t.jsx("button",{className:"btn-link",onClick:()=>{o(e),g(t=>({...t,amount:e.balance})),h(!0)},children:"Record Payment"})})]},e.id)):t.jsx("tr",{children:t.jsx("td",{colSpan:8,style:{textAlign:"center",padding:24,color:"#64748b"},children:"No bills recorded yet. Create your first bill to track payables."})})})]}),l&&t.jsx("div",{className:"modal",children:t.jsxs("div",{className:"modal-content",style:{maxWidth:900,width:"90vw"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("h2",{children:"Create Bill"}),t.jsx("button",{className:"btn-secondary",onClick:()=>r(!1),children:"Close"})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault(),N.mutate()},className:"form-grid",children:[t.jsxs("label",{children:[t.jsx("span",{children:"Vendor"}),t.jsxs("select",{value:b.vendor_id,onChange:e=>f(t=>({...t,vendor_id:e.target.value})),required:!0,children:[t.jsx("option",{value:"",disabled:!0,children:"Select vendor"}),C?.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Bill Date"}),t.jsx("input",{type:"date",value:b.bill_date,onChange:e=>f(t=>({...t,bill_date:e.target.value})),required:!0})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Due Date"}),t.jsx("input",{type:"date",value:b.due_date,onChange:e=>f(t=>({...t,due_date:e.target.value})),required:!0})]}),t.jsxs("div",{style:{gridColumn:"1 / -1",marginTop:12},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[t.jsx("h3",{style:{margin:0},children:"Bill Items"}),t.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>f(e=>({...e,items:[...e.items,{description:"",quantity:1,unit_price:0}]})),children:"+ Add Line"})]}),t.jsx("div",{className:"card",style:{padding:12},children:b.items.map((e,n)=>t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr repeat(4, 1fr)",gap:12,marginBottom:12},children:[t.jsx("input",{placeholder:"Description",value:e.description,onChange:e=>w(n,"description",e.target.value),required:!0}),t.jsx("input",{type:"number",min:1,value:e.quantity,onChange:e=>w(n,"quantity",Number(e.target.value))}),t.jsx("input",{type:"number",min:0,step:"0.01",value:e.unit_price,onChange:e=>w(n,"unit_price",Number(e.target.value))}),t.jsxs("select",{value:e.tax_rate_id||"",onChange:e=>w(n,"tax_rate_id",e.target.value||void 0),children:[t.jsx("option",{value:"",children:"No Tax"}),_?.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",e.rate_percent,"%)"]},e.id))]}),t.jsx("div",{style:{alignSelf:"center",fontWeight:600,textAlign:"right"},children:T(e.quantity*e.unit_price)})]},n))})]}),t.jsxs("label",{style:{gridColumn:"1 / -1"},children:[t.jsx("span",{children:"Notes (optional)"}),t.jsx("textarea",{value:b.memo,onChange:e=>f(t=>({...t,memo:e.target.value})),rows:3})]}),t.jsxs("div",{style:{gridColumn:"1 / -1",background:"#f8fafc",borderRadius:8,padding:16},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[t.jsx("span",{children:"Subtotal"}),t.jsx("span",{children:B.toLocaleString()})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[t.jsx("span",{children:"Tax"}),t.jsx("span",{children:q.toLocaleString()})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:700},children:[t.jsx("span",{children:"Total"}),t.jsx("span",{children:T(D)})]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:12,gridColumn:"1 / -1"},children:[t.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>r(!1),children:"Cancel"}),t.jsx("button",{type:"submit",className:"btn-primary",disabled:N.isPending||!b.vendor_id,children:"Save Bill"})]})]})]})}),c&&d&&t.jsx("div",{className:"modal",children:t.jsxs("div",{className:"modal-content",style:{maxWidth:500},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[t.jsx("h2",{children:"Record Payment"}),t.jsx("button",{className:"btn-secondary",onClick:()=>{h(!1),o(null)},children:"Close"})]}),t.jsxs("div",{className:"card",style:{padding:16,marginBottom:20,background:"#f8fafc"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[t.jsx("span",{style:{color:"#64748b"},children:"Bill:"}),t.jsx("span",{style:{fontWeight:600},children:d.number})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[t.jsx("span",{style:{color:"#64748b"},children:"Vendor:"}),t.jsx("span",{children:d.vendor_name})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[t.jsx("span",{style:{color:"#64748b"},children:"Total:"}),t.jsx("span",{children:T(d.total)})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx("span",{style:{color:"#64748b"},children:"Balance Due:"}),t.jsx("span",{style:{fontWeight:700,color:"#ef4444"},children:T(d.balance)})]})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault(),k.mutate()},className:"form-grid",children:[t.jsxs("label",{children:[t.jsx("span",{children:"Payment Date"}),t.jsx("input",{type:"date",value:y.payment_date,onChange:e=>g(t=>({...t,payment_date:e.target.value})),required:!0})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Amount"}),t.jsx("input",{type:"number",min:0,max:d.balance,step:"0.01",value:y.amount,onChange:e=>g(t=>({...t,amount:Number(e.target.value)})),required:!0})]}),t.jsxs("label",{style:{gridColumn:"1 / -1"},children:[t.jsx("span",{children:"Payment Account"}),t.jsxs("select",{value:y.account_id,onChange:e=>g(t=>({...t,account_id:e.target.value})),required:!0,children:[t.jsx("option",{value:"",children:"Select account..."}),t.jsx("option",{value:"bank",children:"Main Bank"}),t.jsx("option",{value:"mpesa",children:"M-PESA"}),t.jsx("option",{value:"cash",children:"Petty Cash"})]})]}),t.jsxs("label",{style:{gridColumn:"1 / -1"},children:[t.jsx("span",{children:"Reference (optional)"}),t.jsx("input",{type:"text",value:y.reference,onChange:e=>g(t=>({...t,reference:e.target.value})),placeholder:"Check number, transaction ID, etc."})]}),t.jsxs("label",{style:{gridColumn:"1 / -1"},children:[t.jsx("span",{children:"Memo (optional)"}),t.jsx("textarea",{value:y.memo,onChange:e=>g(t=>({...t,memo:e.target.value})),rows:2,placeholder:"Additional notes..."})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:12,gridColumn:"1 / -1"},children:[t.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{h(!1),o(null)},children:"Cancel"}),t.jsx("button",{type:"submit",className:"btn-primary",disabled:k.isPending,children:"Record Payment"})]})]})]})})]})}},Symbol.toStringTag,{value:"Module"}));const k=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const n=s(),[r,c]=a.useState(!1),[h,u]=a.useState({payment_date:(new Date).toISOString().slice(0,10),amount:0,account_id:"",counterparty_id:"",reference:"",memo:"",type:"other"}),{data:p,isLoading:m}=e({queryKey:["finance","payments"],queryFn:()=>o().then(e=>e.data)}),{data:j}=e({queryKey:["finance","accounts"],queryFn:()=>d().then(e=>e.data)}),{data:g}=e({queryKey:["finance","counterparties"],queryFn:()=>x().then(e=>e.data)}),b=i({mutationFn:()=>y(h).then(e=>e.data),onSuccess:()=>{n.invalidateQueries({queryKey:["finance","payments"]}),n.invalidateQueries({queryKey:["finance","kpis"]}),c(!1),u({payment_date:(new Date).toISOString().slice(0,10),amount:0,account_id:"",counterparty_id:"",reference:"",memo:"",type:"other"})}}),f=l(),v=e=>{switch(e){case"receipt":return"#22c55e";case"disbursement":return"#ef4444";case"transfer":return"#3b82f6";default:return"#64748b"}};return t.jsxs("div",{style:{padding:24},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[t.jsxs("div",{children:[t.jsx("h1",{children:"Payments"}),t.jsx("p",{style:{color:"#475569",marginTop:4},children:"Record all money movements - receipts, disbursements, and transfers."})]}),t.jsx("button",{className:"btn-primary",onClick:()=>c(!0),children:"+ Record Payment"})]}),t.jsxs("table",{className:"data-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Date"}),t.jsx("th",{children:"Type"}),t.jsx("th",{children:"Account"}),t.jsx("th",{children:"Counterparty"}),t.jsx("th",{children:"Amount"}),t.jsx("th",{children:"Reference"}),t.jsx("th",{children:"Memo"})]})}),t.jsxs("tbody",{children:[m&&t.jsx("tr",{children:t.jsx("td",{colSpan:7,style:{textAlign:"center",padding:40},children:"Loading..."})}),!m&&0===p?.length&&t.jsx("tr",{children:t.jsx("td",{colSpan:7,style:{textAlign:"center",padding:40},children:"No payments recorded"})}),p?.map(e=>t.jsxs("tr",{children:[t.jsx("td",{children:new Date(e.payment_date).toLocaleDateString()}),t.jsx("td",{children:t.jsx("span",{style:{padding:"4px 8px",borderRadius:4,backgroundColor:v(e.type)+"20",color:v(e.type),fontSize:"0.875rem",fontWeight:500},children:e.type.toUpperCase()})}),t.jsx("td",{children:e.account_name||"-"}),t.jsx("td",{children:e.counterparty_name||"-"}),t.jsx("td",{children:f(e.amount)}),t.jsx("td",{children:e.reference||"-"}),t.jsx("td",{style:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.memo||"-"})]},e.id))]})]}),r&&t.jsx("div",{className:"modal",children:t.jsxs("div",{className:"modal-content",children:[t.jsx("h2",{children:"Record Payment"}),t.jsxs("form",{onSubmit:e=>{e.preventDefault(),b.mutate()},className:"form-grid",children:[t.jsxs("label",{children:[t.jsx("span",{children:"Payment Date"}),t.jsx("input",{type:"date",value:h.payment_date,onChange:e=>u({...h,payment_date:e.target.value}),required:!0})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Payment Type"}),t.jsxs("select",{value:h.type,onChange:e=>u({...h,type:e.target.value}),required:!0,children:[t.jsx("option",{value:"receipt",children:"Receipt (Money In)"}),t.jsx("option",{value:"disbursement",children:"Disbursement (Money Out)"}),t.jsx("option",{value:"transfer",children:"Transfer (Between Accounts)"}),t.jsx("option",{value:"other",children:"Other"})]})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Account"}),t.jsxs("select",{value:h.account_id,onChange:e=>u({...h,account_id:e.target.value}),required:!0,children:[t.jsx("option",{value:"",children:"Select account"}),j?.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",e.kind.toUpperCase(),") - ",e.currency]},e.id))]})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Counterparty (Optional)"}),t.jsxs("select",{value:h.counterparty_id,onChange:e=>u({...h,counterparty_id:e.target.value}),children:[t.jsx("option",{value:"",children:"None"}),g?.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",e.type,")"]},e.id))]})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Amount"}),t.jsx("input",{type:"number",min:0,step:"0.01",value:h.amount,onChange:e=>u({...h,amount:Number(e.target.value)}),required:!0})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Reference"}),t.jsx("input",{value:h.reference,onChange:e=>u({...h,reference:e.target.value}),placeholder:"Transaction reference"})]}),t.jsxs("label",{style:{gridColumn:"1 / -1"},children:[t.jsx("span",{children:"Memo"}),t.jsx("textarea",{value:h.memo,onChange:e=>u({...h,memo:e.target.value}),rows:3,placeholder:"Payment notes"})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:12,gridColumn:"1 / -1"},children:[t.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>c(!1),children:"Cancel"}),t.jsx("button",{type:"submit",className:"btn-primary",disabled:b.isPending||!h.account_id||h.amount<=0,children:"Record Payment"})]})]})]})})]})}},Symbol.toStringTag,{value:"Module"}));const w=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const n=s(),[l,r]=a.useState(!1),[d,o]=a.useState(""),[c,h]=a.useState(""),[x,u]=a.useState(""),[p,m]=a.useState(0),[j,y]=a.useState(""),[b,f]=a.useState(""),[v,S]=a.useState(()=>(new Date).toISOString().slice(0,10)),{data:C,isLoading:_}=e({queryKey:["finance","expenses"],queryFn:()=>g.get("/finance/expenses").then(e=>e.data)}),{data:N}=e({queryKey:["vendors"],queryFn:()=>g.get("/suppliers").then(e=>e.data)}),{data:k}=e({queryKey:["finance","accounts"],queryFn:()=>g.get("/finance/accounts").then(e=>e.data)}),{data:w}=e({queryKey:["finance","chart-of-accounts"],queryFn:()=>g.get("/finance/chart-of-accounts").then(e=>e.data)}),B=a.useMemo(()=>(w??[]).filter(e=>"expense"===e.type),[w]);a.useEffect(()=>{if(c){const e=N?.find(e=>e.id===c);e&&u(e.name)}},[c,N]);const q=i({mutationFn:()=>""===d||""===j?Promise.reject(new Error("Select category and account")):g.post("/finance/expenses",{payee:x||N?.find(e=>e.id===c)?.name||"Miscellaneous",categoryAccountId:Number(d),amount:Number(p),date:v,description:b,accountId:Number(j)}).then(e=>e.data),onSuccess:()=>{n.invalidateQueries({queryKey:["finance","expenses"]}),r(!1),o(""),h(""),u(""),m(0),y(""),f("")}}),D=a.useCallback(e=>B.find(t=>t.id===e)?.name||"Expense",[B]);return t.jsxs("div",{style:{padding:24},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[t.jsxs("div",{children:[t.jsx("h1",{children:"Expenses"}),t.jsx("p",{style:{color:"#475569",marginTop:4},children:"Track operating expenses, assign categories, and sync them with your general ledger."})]}),t.jsx("button",{className:"btn-primary",onClick:()=>r(!0),children:"+ Capture Expense"})]}),_?t.jsx("div",{children:"Loading expenses..."}):t.jsxs("table",{className:"table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Date"}),t.jsx("th",{children:"Category"}),t.jsx("th",{children:"Payee"}),t.jsx("th",{children:"Amount"}),t.jsx("th",{children:"Category"}),t.jsx("th",{children:"Status"}),t.jsx("th",{children:"Description"})]})}),t.jsx("tbody",{children:C?.length?C.map(e=>t.jsxs("tr",{children:[t.jsx("td",{children:new Date(e.date).toLocaleDateString()}),t.jsx("td",{children:e.payee||"-"}),t.jsx("td",{children:e.amount.toLocaleString("en-KE",{style:"currency",currency:"KES"})}),t.jsx("td",{children:D(e.categoryAccountId)}),t.jsx("td",{style:{textTransform:"capitalize"},children:e.status}),t.jsx("td",{children:e.description})]},e.id)):t.jsx("tr",{children:t.jsx("td",{colSpan:6,style:{textAlign:"center",padding:24},children:"No expenses captured yet."})})})]}),l&&t.jsx("div",{className:"modal",children:t.jsxs("div",{className:"modal-content",children:[t.jsx("h2",{children:"Capture Expense"}),t.jsxs("form",{onSubmit:e=>{e.preventDefault(),q.mutate()},className:"form-grid",children:[t.jsxs("label",{children:[t.jsx("span",{children:"Payee"}),t.jsx("input",{value:x,onChange:e=>u(e.target.value),placeholder:"Name of vendor or recipient",required:!0})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Linked Vendor"}),t.jsxs("select",{value:c,onChange:e=>h(e.target.value?Number(e.target.value):""),children:[t.jsx("option",{value:"",children:"No vendor"}),N?.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Category (Expense Account)"}),t.jsxs("select",{value:d,onChange:e=>o(e.target.value?Number(e.target.value):""),required:!0,children:[t.jsx("option",{value:"",disabled:!0,children:"Select account"}),B.map(e=>t.jsxs("option",{value:e.id,children:[e.code," • ",e.name]},e.id))]})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Amount"}),t.jsx("input",{type:"number",min:0,step:"0.01",value:p,onChange:e=>m(Number(e.target.value)),required:!0})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Paid From Account"}),t.jsxs("select",{value:j,onChange:e=>y(e.target.value?Number(e.target.value):""),required:!0,children:[t.jsx("option",{value:"",disabled:!0,children:"Select account"}),k?.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",e.type,")"]},e.id))]})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Date"}),t.jsx("input",{type:"date",value:v,onChange:e=>S(e.target.value),required:!0})]}),t.jsxs("label",{style:{gridColumn:"1 / -1"},children:[t.jsx("span",{children:"Description"}),t.jsx("textarea",{value:b,onChange:e=>f(e.target.value),placeholder:"What was this expense for?",rows:3})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:12,gridColumn:"1 / -1"},children:[t.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>r(!1),children:"Cancel"}),t.jsx("button",{type:"submit",className:"btn-primary",disabled:q.isPending||!d||!x,children:"Save Expense"})]})]})]})})]})}},Symbol.toStringTag,{value:"Module"}));const B=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const[n,s]=a.useState("kpis"),[i,l]=a.useState(()=>{const e=new Date;return new Date(e.getFullYear(),e.getMonth(),1).toISOString().slice(0,10)}),[d,o]=a.useState(()=>(new Date).toISOString().slice(0,10)),{data:c}=e({queryKey:["finance","reports","kpis"],queryFn:()=>r().then(e=>e.data)}),{data:h}=e({queryKey:["finance","reports","trial-balance",i,d],queryFn:()=>b({startDate:i,endDate:d}).then(e=>e.data)}),{data:x,refetch:u,isFetching:p}=e({queryKey:["finance","reports","pl",i,d],queryFn:()=>f({startDate:i,endDate:d}).then(e=>e.data)}),{data:m}=e({queryKey:["finance","reports","balance-sheet",d],queryFn:()=>v({asOfDate:d}).then(e=>e.data)}),j=e=>e?.toLocaleString("en-KE",{style:"currency",currency:"KES"})??"KES 0.00";return t.jsxs("div",{style:{padding:24},children:[t.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[t.jsxs("div",{children:[t.jsx("h1",{children:"Financial Reports"}),t.jsx("p",{style:{color:"#475569",marginTop:4},children:"Comprehensive financial statements and analysis"})]}),t.jsxs("div",{style:{display:"flex",gap:12,alignItems:"flex-end"},children:[t.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12,color:"#475569"},children:["Report Type",t.jsxs("select",{value:n,onChange:e=>s(e.target.value),style:{marginTop:4},children:[t.jsx("option",{value:"kpis",children:"KPIs Dashboard"}),t.jsx("option",{value:"trial-balance",children:"Trial Balance"}),t.jsx("option",{value:"pl",children:"Profit & Loss"}),t.jsx("option",{value:"balance-sheet",children:"Balance Sheet"})]})]}),t.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12,color:"#475569"},children:["Start Date",t.jsx("input",{type:"date",value:i,onChange:e=>l(e.target.value),style:{marginTop:4}})]}),t.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12,color:"#475569"},children:["End Date",t.jsx("input",{type:"date",value:d,onChange:e=>o(e.target.value),style:{marginTop:4}})]}),t.jsx("button",{className:"btn-secondary",onClick:()=>u(),disabled:p,children:"Refresh"})]})]}),"kpis"===n&&t.jsx(t.Fragment,{children:t.jsx("section",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:16,marginBottom:32},children:[{label:"Total Receivables",value:j(c?.accounts_receivable),highlight:"#0ea5e9"},{label:"Total Payables",value:j(c?.accounts_payable),highlight:"#ef4444"},{label:"Cash on Hand",value:j(c?.cash_on_hand),highlight:"#22c55e"},{label:"Revenue",value:j(c?.revenue),highlight:"#8b5cf6"},{label:"Expenses",value:j(c?.expenses),highlight:"#f59e0b"},{label:"Profit",value:j(c?.profit),highlight:c&&c.profit>=0?"#22c55e":"#ef4444"}].map(e=>t.jsxs("div",{style:{background:"#fff",borderRadius:12,padding:20,boxShadow:"0 8px 18px rgba(15, 23, 42, 0.08)",borderTop:`4px solid ${e.highlight}`},children:[t.jsx("p",{style:{color:"#475569",fontSize:14,marginBottom:8},children:e.label}),t.jsx("h2",{style:{fontSize:24,fontWeight:600},children:e.value})]},e.label))})}),"trial-balance"===n&&t.jsxs("section",{style:{background:"#fff",borderRadius:12,padding:24,boxShadow:"0 8px 18px rgba(15, 23, 42, 0.08)"},children:[t.jsx("h2",{style:{marginBottom:16},children:"Trial Balance"}),t.jsxs("p",{style:{color:"#64748b",fontSize:14,marginBottom:16},children:["Period: ",i," to ",d]}),t.jsxs("table",{className:"data-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Code"}),t.jsx("th",{children:"Account Name"}),t.jsx("th",{style:{textAlign:"right"},children:"Debit"}),t.jsx("th",{style:{textAlign:"right"},children:"Credit"})]})}),t.jsxs("tbody",{children:[h?.map((e,n)=>t.jsxs("tr",{children:[t.jsx("td",{children:e.code}),t.jsx("td",{children:e.name}),t.jsx("td",{style:{textAlign:"right",fontFamily:"monospace"},children:parseFloat(e.total_debit)>0?j(parseFloat(e.total_debit)):"-"}),t.jsx("td",{style:{textAlign:"right",fontFamily:"monospace"},children:parseFloat(e.total_credit)>0?j(parseFloat(e.total_credit)):"-"})]},n)),h&&h.length>0&&t.jsxs("tr",{style:{borderTop:"2px solid #000",fontWeight:700},children:[t.jsx("td",{colSpan:2,children:"Total"}),t.jsx("td",{style:{textAlign:"right",fontFamily:"monospace"},children:j(h.reduce((e,t)=>e+parseFloat(t.total_debit),0))}),t.jsx("td",{style:{textAlign:"right",fontFamily:"monospace"},children:j(h.reduce((e,t)=>e+parseFloat(t.total_credit),0))})]})]})]})]}),"pl"===n&&t.jsxs("section",{style:{background:"#fff",borderRadius:12,padding:24,boxShadow:"0 8px 18px rgba(15, 23, 42, 0.08)"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[t.jsx("h2",{children:"Profit & Loss Statement"}),p&&t.jsx("span",{style:{color:"#6366f1"},children:"Refreshing…"})]}),t.jsxs("p",{style:{color:"#64748b",fontSize:14,marginBottom:16},children:["Period: ",i," to ",d]}),t.jsx("table",{className:"table",children:t.jsxs("tbody",{children:[t.jsxs("tr",{children:[t.jsx("td",{children:"Revenue"}),t.jsx("td",{style:{textAlign:"right"},children:j(x?.revenue)}),t.jsx("td",{})]}),t.jsxs("tr",{children:[t.jsx("td",{children:"Cost of Goods Sold"}),t.jsx("td",{style:{textAlign:"right"},children:j(x?.cost_of_goods_sold)}),t.jsx("td",{})]}),t.jsxs("tr",{style:{borderTop:"1px solid #e2e8f0"},children:[t.jsx("td",{children:t.jsx("strong",{children:"Gross Profit"})}),t.jsx("td",{style:{textAlign:"right"},children:t.jsx("strong",{children:j(x?.gross_profit)})}),t.jsx("td",{children:"number"==typeof x?.gross_profit_margin?`${x.gross_profit_margin.toFixed(1)}% margin`:""})]}),t.jsxs("tr",{children:[t.jsx("td",{children:"Operating Expenses"}),t.jsx("td",{style:{textAlign:"right"},children:j(x?.operating_expenses)}),t.jsx("td",{})]}),t.jsxs("tr",{style:{borderTop:"2px solid #000",fontWeight:700},children:[t.jsx("td",{children:t.jsx("strong",{children:"Net Profit"})}),t.jsx("td",{style:{textAlign:"right"},children:t.jsx("strong",{children:j(x?.net_profit)})}),t.jsx("td",{children:"number"==typeof x?.net_profit_margin?`${x.net_profit_margin.toFixed(1)}% margin`:""})]})]})})]}),"balance-sheet"===n&&t.jsxs("section",{style:{background:"#fff",borderRadius:12,padding:24,boxShadow:"0 8px 18px rgba(15, 23, 42, 0.08)"},children:[t.jsx("h2",{style:{marginBottom:16},children:"Balance Sheet"}),t.jsxs("p",{style:{color:"#64748b",fontSize:14,marginBottom:16},children:["As of: ",d]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:32},children:[t.jsxs("div",{children:[t.jsx("h3",{style:{fontSize:18,marginBottom:12},children:"Assets"}),t.jsx("table",{className:"table",children:t.jsxs("tbody",{children:[t.jsx("tr",{style:{fontWeight:600,backgroundColor:"#f8fafc"},children:t.jsx("td",{colSpan:2,children:"Current Assets"})}),m?.assets.current_assets.map((e,n)=>t.jsxs("tr",{children:[t.jsx("td",{style:{paddingLeft:20},children:e.name}),t.jsx("td",{style:{textAlign:"right"},children:j(e.amount)})]},n)),t.jsx("tr",{style:{fontWeight:600,backgroundColor:"#f8fafc"},children:t.jsx("td",{colSpan:2,children:"Fixed Assets"})}),m?.assets.fixed_assets.map((e,n)=>t.jsxs("tr",{children:[t.jsx("td",{style:{paddingLeft:20},children:e.name}),t.jsx("td",{style:{textAlign:"right"},children:j(e.amount)})]},n)),t.jsxs("tr",{style:{borderTop:"2px solid #000",fontWeight:700},children:[t.jsx("td",{children:"Total Assets"}),t.jsx("td",{style:{textAlign:"right"},children:j(m?.assets.total_assets)})]})]})})]}),t.jsxs("div",{children:[t.jsx("h3",{style:{fontSize:18,marginBottom:12},children:"Liabilities & Equity"}),t.jsx("table",{className:"table",children:t.jsxs("tbody",{children:[t.jsx("tr",{style:{fontWeight:600,backgroundColor:"#f8fafc"},children:t.jsx("td",{colSpan:2,children:"Current Liabilities"})}),m?.liabilities.current_liabilities.map((e,n)=>t.jsxs("tr",{children:[t.jsx("td",{style:{paddingLeft:20},children:e.name}),t.jsx("td",{style:{textAlign:"right"},children:j(e.amount)})]},n)),t.jsx("tr",{style:{fontWeight:600,backgroundColor:"#f8fafc"},children:t.jsx("td",{colSpan:2,children:"Long-term Liabilities"})}),m?.liabilities.long_term_liabilities.map((e,n)=>t.jsxs("tr",{children:[t.jsx("td",{style:{paddingLeft:20},children:e.name}),t.jsx("td",{style:{textAlign:"right"},children:j(e.amount)})]},n)),t.jsxs("tr",{style:{borderTop:"1px solid #e2e8f0",fontWeight:600},children:[t.jsx("td",{children:"Total Liabilities"}),t.jsx("td",{style:{textAlign:"right"},children:j(m?.liabilities.total_liabilities)})]}),t.jsx("tr",{style:{fontWeight:600,backgroundColor:"#f8fafc"},children:t.jsx("td",{colSpan:2,children:"Equity"})}),m?.equity.items.map((e,n)=>t.jsxs("tr",{children:[t.jsx("td",{style:{paddingLeft:20},children:e.name}),t.jsx("td",{style:{textAlign:"right"},children:j(e.amount)})]},n)),t.jsxs("tr",{style:{borderTop:"1px solid #e2e8f0",fontWeight:600},children:[t.jsx("td",{children:"Total Equity"}),t.jsx("td",{style:{textAlign:"right"},children:j(m?.equity.total_equity)})]}),t.jsxs("tr",{style:{borderTop:"2px solid #000",fontWeight:700},children:[t.jsx("td",{children:"Total Liabilities & Equity"}),t.jsx("td",{style:{textAlign:"right"},children:j((m?.liabilities.total_liabilities||0)+(m?.equity.total_equity||0))})]})]})})]})]})]})]})}},Symbol.toStringTag,{value:"Module"}));const q=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const n=s(),{data:l}=e({queryKey:["finance","settings"],queryFn:()=>g.get("/finance/settings").then(e=>e.data)}),[r,d]=a.useState(null);a.useEffect(()=>{l&&d(l)},[l]);const o=i({mutationFn:e=>g.put("/finance/settings",e).then(e=>e.data),onSuccess:e=>{d(e),n.invalidateQueries({queryKey:["finance","settings"]})}}),c=(e,t)=>{d(n=>n?{...n,[e]:t}:n)};return r?t.jsxs("div",{style:{padding:24,display:"grid",gap:24},children:[t.jsxs("header",{children:[t.jsx("h1",{children:"Finance Settings"}),t.jsx("p",{style:{color:"#475569",marginTop:4},children:"Configure Smart Books defaults, M-PESA integration, and SMTP for statement delivery."})]}),t.jsxs("section",{style:{background:"#fff",borderRadius:12,padding:24,boxShadow:"0 8px 18px rgba(15, 23, 42, 0.08)"},children:[t.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx("h2",{children:"Company Profile"}),t.jsx("p",{style:{color:"#64748b",fontSize:14},children:"This information appears on invoices, bills, and statements."})]}),t.jsx("button",{className:"btn-primary",onClick:()=>o.mutate(r),disabled:o.isPending,children:"Save"})]}),t.jsxs("div",{className:"form-grid",style:{marginTop:24},children:[t.jsxs("label",{children:[t.jsx("span",{children:"Company Name"}),t.jsx("input",{value:r.companyName,onChange:e=>c("companyName",e.target.value)})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Company Email"}),t.jsx("input",{value:r.companyEmail||"",onChange:e=>c("companyEmail",e.target.value)})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Company Phone"}),t.jsx("input",{value:r.companyPhone||"",onChange:e=>c("companyPhone",e.target.value)})]}),t.jsxs("label",{style:{gridColumn:"1 / -1"},children:[t.jsx("span",{children:"Address"}),t.jsx("textarea",{value:r.companyAddress||"",onChange:e=>c("companyAddress",e.target.value),rows:2})]})]})]}),t.jsxs("section",{style:{background:"#fff",borderRadius:12,padding:24,boxShadow:"0 8px 18px rgba(15, 23, 42, 0.08)"},children:[t.jsx("h2",{children:"Numbering & Defaults"}),t.jsxs("div",{className:"form-grid",style:{marginTop:16},children:[t.jsxs("label",{children:[t.jsx("span",{children:"Base Currency"}),t.jsx("input",{value:r.baseCurrency,maxLength:3,onChange:e=>c("baseCurrency",e.target.value.toUpperCase())})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Default Payment Terms"}),t.jsx("input",{value:r.defaultPaymentTerms,onChange:e=>c("defaultPaymentTerms",e.target.value)})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Fiscal Year Start (MM-DD)"}),t.jsx("input",{value:r.fiscalYearStart,onChange:e=>c("fiscalYearStart",e.target.value)})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Invoice Number Format"}),t.jsx("input",{value:r.invoiceNumberFormat,onChange:e=>c("invoiceNumberFormat",e.target.value)})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Bill Number Format"}),t.jsx("input",{value:r.billNumberFormat,onChange:e=>c("billNumberFormat",e.target.value)})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Payment Number Format"}),t.jsx("input",{value:r.paymentNumberFormat,onChange:e=>c("paymentNumberFormat",e.target.value)})]})]})]}),t.jsxs("section",{style:{background:"#fff",borderRadius:12,padding:24,boxShadow:"0 8px 18px rgba(15, 23, 42, 0.08)"},children:[t.jsx("h2",{children:"M-PESA STK Push"}),t.jsx("p",{style:{color:"#64748b",fontSize:14,marginBottom:16},children:"These credentials enable real-time push-to-pay for vendor bills and invoice collections."}),t.jsxs("div",{className:"form-grid",children:[t.jsxs("label",{children:[t.jsx("span",{children:"Consumer Key"}),t.jsx("input",{value:r.mpesaConsumerKey||"",onChange:e=>c("mpesaConsumerKey",e.target.value)})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Consumer Secret"}),t.jsx("input",{value:r.mpesaConsumerSecret||"",onChange:e=>c("mpesaConsumerSecret",e.target.value)})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Shortcode"}),t.jsx("input",{value:r.mpesaShortcode||"",onChange:e=>c("mpesaShortcode",e.target.value)})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Passkey"}),t.jsx("input",{value:r.mpesaPasskey||"",onChange:e=>c("mpesaPasskey",e.target.value)})]})]})]}),t.jsxs("section",{style:{background:"#fff",borderRadius:12,padding:24,boxShadow:"0 8px 18px rgba(15, 23, 42, 0.08)"},children:[t.jsx("h2",{children:"SMTP Email"}),t.jsx("p",{style:{color:"#64748b",fontSize:14,marginBottom:16},children:"Send invoices, receipts, and statements directly from ProcureX."}),t.jsxs("div",{className:"form-grid",children:[t.jsxs("label",{children:[t.jsx("span",{children:"Host"}),t.jsx("input",{value:r.smtpHost||"",onChange:e=>c("smtpHost",e.target.value)})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Port"}),t.jsx("input",{type:"number",value:r.smtpPort||"",onChange:e=>c("smtpPort",e.target.value?Number(e.target.value):void 0)})]}),t.jsxs("label",{children:[t.jsx("span",{children:"SMTP User"}),t.jsx("input",{value:r.smtpUser||"",onChange:e=>c("smtpUser",e.target.value)})]}),t.jsxs("label",{children:[t.jsx("span",{children:"SMTP Password"}),t.jsx("input",{type:"password",value:r.smtpPassword||"",onChange:e=>c("smtpPassword",e.target.value)})]})]})]}),o.isSuccess&&r&&t.jsxs("div",{style:{background:"#ecfdf5",color:"#047857",padding:12,borderRadius:8},children:["Settings saved. Updated at ",new Date(r.updatedAt).toLocaleString(),"."]})]}):t.jsx("div",{style:{padding:24},children:"Loading settings…"})}},Symbol.toStringTag,{value:"Module"}));export{C as B,w as E,S as F,_ as I,k as P,B as R,q as S,N as a};
